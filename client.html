<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalle del Cliente | Cero Deuda</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Tenor+Sans&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Wrapper principal - Scroll interno si es necesario */
    .lead-view-wrapper {
      width: 100%;
      height: 100vh;
      position: relative;
      z-index: 1;
      overflow-y: auto;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
    }
    
    .lead-floating {
      width: calc(100% - clamp(12px, 2vw, 28px));
      margin: clamp(8px, 1.2vh, 16px) auto;
      display: grid;
      grid-template-columns: auto 1fr auto;
      grid-template-rows: auto minmax(0, 1fr);
      gap: 8px clamp(12px, 2vw, 24px);
      align-items: start;
      flex: 1;
      min-height: 0;
    }
    
    /* Logo igual que dashboard */
    .lead-logo {
      grid-column: 1;
      grid-row: 1;
      width: clamp(70px, 5vw, 100px);
      height: auto;
      display: block;
      justify-self: start;
      align-self: center;
      position: relative;
      z-index: 5;
    }
    
    /* Toolbar en misma posición que dashboard */
    .lead-floating .toolbar-wrap {
      grid-column: 2;
      grid-row: 1;
      justify-self: center;
    }
    
    /* Home actions en misma posición */
    .lead-floating .home-actions {
      grid-column: 3;
      grid-row: 1;
      justify-self: end;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    /* Contenido del lead debajo del toolbar */
    .lead-content-area {
      grid-column: 1 / -1;
      grid-row: 2;
      padding: 12px 24px 24px;
      position: relative;
      z-index: 2;
      min-height: 0;
    }
    
    /* Header del Lead */
    .lead-header {
      padding-bottom: 16px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      position: relative;
      z-index: 3;
      flex-shrink: 0;
    }
    
    /* Sección del nombre */
    .lead-title-section {
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }
    
    /* Nombre del cliente editable */
    .lead-name-wrapper {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .lead-name-text {
      font-size: clamp(1.5rem, 3vw, 2rem);
      font-weight: 600;
      color: white;
      background: transparent;
      border: 2px solid transparent;
      border-radius: 8px;
      padding: 4px 12px;
      margin: 0;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 150px;
      display: inline-block;
      position: relative;
      z-index: 4;
    }
    
    .lead-name-text:hover {
      border-color: rgba(255, 255, 255, 0.2);
      background: rgba(255, 255, 255, 0.05);
    }
    
    .lead-name-text.editing {
      border-color: rgba(255, 255, 255, 0.4);
      background: rgba(255, 255, 255, 0.1);
      cursor: text;
    }
    
    .lead-name-text:focus {
      outline: none;
      border-color: var(--accent, #7eeafc);
      background: rgba(255, 255, 255, 0.1);
    }
    
    /* Botón de cambio Applicant/Co-Applicant */
    .applicant-toggle-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: rgba(255, 255, 255, 0.7);
      cursor: pointer;
      transition: all 0.3s ease;
      padding: 0;
      flex-shrink: 0;
    }
    
    .applicant-toggle-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }
    
    .applicant-toggle-btn svg {
      width: 16px;
      height: 16px;
      transition: transform 0.3s ease;
    }
    
    .applicant-toggle-btn.rotated svg {
      transform: rotate(180deg);
    }
    
    .applicant-type-label {
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.5);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 500;
      padding: 4px 8px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      transition: all 0.3s ease;
    }
    
    .applicant-type-label.co-applicant {
      background: rgba(59, 130, 246, 0.15);
      border-color: rgba(59, 130, 246, 0.3);
      color: #60a5fa;
    }
    
    /* Botón de copiar nombre - solo icono, sin box (igual que copy-icon-btn) */
    .copy-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.5);
      cursor: pointer;
      transition: all 0.2s ease;
      padding: 0;
      margin-left: 4px;
    }
    
    .copy-btn:hover {
      color: white;
      transform: scale(1.1);
    }
    
    .copy-btn svg {
      width: 18px;
      height: 18px;
    }
    
    .copy-btn.copied {
      color: #4ade80;
    }
    
    /* Badge de State Type (Green/Red) */
    .lead-state-badge {
      font-size: 0.85rem;
      font-weight: 600;
      padding: 6px 14px;
      border-radius: 20px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: inline-block;
      position: relative;
      z-index: 4;
    }
    
    .lead-state-badge.green {
      background: rgba(34, 197, 94, 0.2);
      color: #4ade80;
      border: 1px solid rgba(34, 197, 94, 0.3);
    }
    
    .lead-state-badge.red {
      background: rgba(239, 68, 68, 0.2);
      color: #f87171;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }
    
    /* Badge de Test */
    .lead-test-badge {
      font-size: 0.75rem;
      font-weight: 600;
      padding: 4px 10px;
      border-radius: 12px;
      background: rgba(168, 85, 247, 0.2);
      color: #c084fc;
      border: 1px solid rgba(168, 85, 247, 0.3);
      text-transform: uppercase;
      display: inline-block;
      position: relative;
      z-index: 4;
    }
    
    /* Case ID debajo del nombre */
    .lead-case-id {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 1rem;
      color: rgba(255, 255, 255, 0.6);
      margin-left: 12px;
    }
    
    .lead-case-id .case-label {
      font-weight: 500;
    }
    
    .lead-case-id .case-number {
      font-family: 'Inter', monospace;
      color: rgba(255, 255, 255, 0.8);
      font-weight: 600;
    }
    
    /* Botón de copiar para Case ID - solo icono, sin box */
    .copy-icon-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.5);
      cursor: pointer;
      transition: all 0.2s ease;
      padding: 0;
      margin-left: 4px;
    }
    
    .copy-icon-btn:hover {
      color: white;
      transform: scale(1.1);
    }
    
    .copy-icon-btn svg {
      width: 14px;
      height: 14px;
    }
    
    .copy-icon-btn.copied {
      color: #4ade80;
    }
    
    /* Barra de herramientas del lead */
    .lead-toolbar {
      display: flex;
      align-items: center;
      gap: 8px;
      padding-top: 12px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: 6px;
      flex-wrap: wrap;
    }
    
    .toolbar-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 8px;
      color: white;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }
    
    .toolbar-btn:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateY(-1px);
    }
    
    .toolbar-btn svg {
      width: 18px;
      height: 18px;
    }
    
    .toolbar-btn.back-btn {
      margin-right: auto;
    }
    
    /* Grid de contenido - Responsivo y Compacto */
    .lead-content-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      align-content: start;
    }
    
    @media (max-width: 1200px) {
      .lead-content-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (max-width: 900px) {
      .lead-content-grid {
        grid-template-columns: 1fr;
        gap: 10px;
      }
      
      .lead-floating {
        grid-template-columns: 1fr auto;
      }
      
      .lead-logo {
        display: none;
      }
      
      .lead-floating .toolbar-wrap {
        grid-column: 1;
      }
      
      .lead-floating .home-actions {
        grid-column: 2;
      }
      
      .lead-content-area {
        padding: 8px 16px;
      }
    }
    
    @media (max-width: 600px) {
      .lead-title-section {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      
      .lead-name-text {
        font-size: 1.3rem;
        padding: 2px 8px;
      }
      
      .lead-case-id {
        margin-left: 8px;
      }
      
      .toolbar-btn span {
        display: none;
      }
      
      .toolbar-btn {
        padding: 8px;
      }
      
      .custom-calendar {
        width: 260px;
        left: 50% !important;
        transform: translateX(-50%);
      }
      
      .include-toggle-wrapper {
        margin-left: 8px;
        padding-left: 8px;
        gap: 6px;
      }
      
      .include-toggle-status {
        font-size: 0.65rem;
        min-width: 24px;
      }
      
      .include-toggle {
        width: 32px;
        height: 16px;
      }
      
      .include-toggle-thumb {
        width: 12px;
        height: 12px;
      }
      
      .include-toggle input:checked + .include-toggle-track .include-toggle-thumb {
        transform: translateX(16px);
      }
    }
    
    .lead-info-card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 16px 20px;
    }
    
    .lead-info-card h3 {
      margin: 0 0 12px 0;
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.5);
      text-transform: uppercase;
      letter-spacing: 1px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .lead-info-card-wide {
      grid-column: 1 / -1;
    }
    
    .two-column-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      align-items: start;
    }
    
    .info-column {
      min-width: 0;
    }
    
    @media (max-width: 900px) {
      .two-column-layout {
        grid-template-columns: 1fr;
        gap: 16px;
      }
    }
    
    /* Input de fecha para Callback - Liquid Glass */
    .callback-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .date-input {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      padding: 6px 12px;
      color: white;
      font-family: 'Inter', sans-serif;
      font-size: 0.9rem;
      cursor: pointer;
      outline: none;
      transition: all 0.2s ease;
    }
    
    .date-input:hover, .date-input:focus {
      border-color: rgba(255, 255, 255, 0.4);
      background: rgba(255, 255, 255, 0.12);
    }
    
    /* Liquid Glass Input */
    .liquid-glass-input {
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.15) 0%, 
        rgba(255, 255, 255, 0.05) 100%
      );
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.25);
      box-shadow: 
        0 4px 24px rgba(0, 0, 0, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }
    
    .liquid-glass-input:hover {
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.2) 0%, 
        rgba(255, 255, 255, 0.08) 100%
      );
      border-color: rgba(255, 255, 255, 0.35);
      box-shadow: 
        0 6px 32px rgba(0, 0, 0, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.25);
    }
    
    .liquid-glass-input:focus {
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.25) 0%, 
        rgba(255, 255, 255, 0.1) 100%
      );
      border-color: var(--accent, #7eeafc);
      box-shadow: 
        0 0 20px rgba(126, 234, 252, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
    }
    
    /* Liquid Glass Button */
    .liquid-glass-btn {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 8px 16px;
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.15) 0%, 
        rgba(255, 255, 255, 0.05) 100%
      );
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.25);
      border-radius: 10px;
      color: white;
      font-family: 'Inter', sans-serif;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 
        0 4px 24px rgba(0, 0, 0, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
      white-space: nowrap;
    }
    
    .liquid-glass-btn:hover {
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.25) 0%, 
        rgba(255, 255, 255, 0.1) 100%
      );
      border-color: rgba(255, 255, 255, 0.4);
      box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.25);
      transform: translateY(-2px);
    }
    
    .liquid-glass-btn svg {
      width: 18px;
      height: 18px;
      opacity: 0.7;
    }
    
    /* Body setup - Sin scroll */
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      position: fixed;
    }
    
    /* Callback Row - Contenedor relativo */
    .callback-row {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    /* Callback Wrapper */
    .callback-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
      position: relative;
    }
    
    /* Custom Calendar - Liquid Glass Dropdown */
    .custom-calendar {
      position: absolute;
      bottom: calc(100% + 4px);
      right: 0;
      width: 260px;
      background: linear-gradient(135deg, 
        rgba(40, 40, 55, 0.98) 0%, 
        rgba(25, 25, 35, 0.99) 100%
      );
      backdrop-filter: blur(40px);
      -webkit-backdrop-filter: blur(40px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      padding: 12px;
      box-shadow: 
        0 -12px 40px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
      z-index: 1000;
      animation: calendarAppear 0.2s ease;
    }
    
    @keyframes calendarAppear {
      from {
        opacity: 0;
        transform: translateY(-4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .custom-calendar.hidden {
      display: none;
    }
    
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .calendar-title {
      color: white;
      font-weight: 600;
      font-size: 0.9rem;
      text-transform: capitalize;
    }
    
    .calendar-nav {
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 6px;
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
      padding: 0;
    }
    
    .calendar-nav:hover {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.25);
    }
    
    .calendar-nav svg {
      width: 14px;
      height: 14px;
    }
    
    .calendar-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 2px;
      margin-bottom: 4px;
    }
    
    .calendar-weekdays span {
      text-align: center;
      font-size: 0.65rem;
      color: rgba(255, 255, 255, 0.4);
      font-weight: 500;
      padding: 4px 0;
    }
    
    .calendar-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 2px;
    }
    
    .calendar-day {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      border: 1px solid transparent;
      border-radius: 6px;
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      padding: 0;
    }
    
    .calendar-day:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.2);
    }
    
    .calendar-day.other-month {
      color: rgba(255, 255, 255, 0.3);
    }
    
    .calendar-day.today {
      background: rgba(126, 234, 252, 0.15);
      border-color: rgba(126, 234, 252, 0.3);
      color: var(--accent, #7eeafc);
      font-weight: 600;
    }
    
    .calendar-day.selected {
      background: linear-gradient(135deg, 
        rgba(34, 197, 94, 0.3) 0%, 
        rgba(34, 197, 94, 0.15) 100%
      );
      border-color: rgba(34, 197, 94, 0.5);
      color: #4ade80;
      font-weight: 600;
    }
    
    .calendar-day.selected::after {
      content: '';
      position: absolute;
      bottom: 4px;
      width: 4px;
      height: 4px;
      background: #4ade80;
      border-radius: 50%;
      box-shadow: 0 0 8px #4ade80;
    }
    
    .calendar-day.has-pin::before {
      content: '';
      position: absolute;
      top: 2px;
      right: 2px;
      width: 8px;
      height: 8px;
      background: linear-gradient(135deg, #4ade80, #22c55e);
      border-radius: 50%;
      box-shadow: 0 0 6px rgba(34, 197, 94, 0.6);
      animation: pinPulse 2s infinite;
    }
    
    @keyframes pinPulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.8; }
    }
    
    /* Callback Button - Estilo Mac simple (Verde) */
    .callback-mac-btn {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: #22c55e;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.3), 0 1px 2px rgba(0, 0, 0, 0.2);
      padding: 0;
      margin: 0;
      display: block;
      flex-shrink: 0;
    }
    
    .callback-mac-btn:hover {
      background: #16a34a;
      transform: scale(1.15);
    }
    
    .callback-mac-btn:active {
      transform: scale(0.9);
    }
    
    .callback-mac-btn.hidden {
      display: none;
    }
    
    /* FICO Score */
    .fico-score {
      font-weight: 600;
      color: var(--accent, #7eeafc);
    }
    
    .fico-score.pendiente {
      color: rgba(255, 255, 255, 0.4);
    }
    
    .info-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      gap: 12px;
    }
    
    .info-row:last-child {
      border-bottom: none;
    }
    
    .info-row-label {
      color: rgba(255, 255, 255, 0.5);
      font-size: 0.8rem;
      flex-shrink: 0;
    }
    
    .info-row-value {
      color: white;
      font-weight: 500;
      font-size: 0.85rem;
      text-align: right;
      word-break: break-word;
    }
    
    .info-row-value.mono {
      font-family: 'Inter', monospace;
    }
    
    .loading {
      text-align: center;
      padding: 60px 20px;
      color: rgba(255, 255, 255, 0.6);
      grid-column: 1 / -1;
    }
    
    .loading svg {
      width: 48px;
      height: 48px;
      animation: spin 1s linear infinite;
      margin-bottom: 16px;
    }
    
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .error {
      text-align: center;
      padding: 60px 20px;
      color: #f87171;
      grid-column: 1 / -1;
    }
    
    /* Tema claro */
    body.home-active.theme-light .lead-name-text {
      color: #1a1a1a;
    }
    
    body.home-active.theme-light .lead-name-text:hover {
      border-color: rgba(0, 0, 0, 0.15);
      background: rgba(0, 0, 0, 0.03);
    }
    
    body.home-active.theme-light .lead-name-text:focus {
      background: rgba(255, 255, 255, 0.8);
    }
    
    body.home-active.theme-light .lead-case-id {
      color: rgba(0, 0, 0, 0.6);
    }
    
    body.home-active.theme-light .lead-case-id .case-number {
      color: rgba(0, 0, 0, 0.8);
    }
    
    body.home-active.theme-light .copy-icon-btn {
      color: rgba(0, 0, 0, 0.4);
    }
    
    body.home-active.theme-light .copy-icon-btn:hover {
      color: #1a1a1a;
    }
    
    body.home-active.theme-light .copy-btn {
      background: transparent;
      color: rgba(0, 0, 0, 0.4);
    }
    
    body.home-active.theme-light .copy-btn:hover {
      color: #1a1a1a;
    }
    
    body.home-active.theme-light .copy-btn.copied {
      color: #16a34a;
    }
    
    body.home-active.theme-light .applicant-toggle-btn {
      background: rgba(0, 0, 0, 0.06);
      border-color: rgba(0, 0, 0, 0.12);
      color: rgba(0, 0, 0, 0.6);
    }
    
    body.home-active.theme-light .applicant-toggle-btn:hover {
      background: rgba(0, 0, 0, 0.1);
      color: #1a1a1a;
    }
    
    body.home-active.theme-light .applicant-type-label {
      background: rgba(0, 0, 0, 0.04);
      border-color: rgba(0, 0, 0, 0.1);
      color: rgba(0, 0, 0, 0.5);
    }
    
    body.home-active.theme-light .applicant-type-label.co-applicant {
      background: rgba(59, 130, 246, 0.1);
      border-color: rgba(59, 130, 246, 0.25);
      color: #2563eb;
    }
    
    /* ============ INCLUDE CO-APPLICANT TOGGLE STYLES ============ */
    .include-toggle-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-left: 12px;
      padding-left: 12px;
      border-left: 1px solid rgba(255, 255, 255, 0.15);
      transition: all 0.3s ease;
    }
    
    .include-toggle-wrapper.hidden {
      display: none;
    }
    
    .include-toggle-status {
      font-size: 0.7rem;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.4);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      min-width: 28px;
      text-align: center;
      transition: all 0.3s ease;
    }
    
    .include-toggle-wrapper.active .include-toggle-status {
      color: #2ecc71;
      text-shadow: 0 0 8px rgba(46, 204, 113, 0.5);
    }
    
    .include-toggle {
      position: relative;
      display: inline-block;
      width: 36px;
      height: 18px;
      cursor: pointer;
    }
    
    .include-toggle input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .include-toggle-track {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 18px;
      transition: background 0.3s ease, box-shadow 0.3s ease;
    }
    
    .include-toggle input:checked + .include-toggle-track {
      background: rgba(46, 204, 113, 0.25);
      box-shadow: 0 0 10px rgba(46, 204, 113, 0.25), inset 0 0 4px rgba(46, 204, 113, 0.15);
    }
    
    .include-toggle-thumb {
      position: absolute;
      top: 2px;
      left: 2px;
      width: 14px;
      height: 14px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 50%;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), background 0.3s ease;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }
    
    .include-toggle input:checked + .include-toggle-track .include-toggle-thumb {
      transform: translateX(18px);
      background: #2ecc71;
      box-shadow: 0 2px 6px rgba(46, 204, 113, 0.4);
    }
    
    /* Light theme styles for toggle */
    body.home-active.theme-light .include-toggle-wrapper {
      border-left-color: rgba(0, 0, 0, 0.1);
    }
    
    body.home-active.theme-light .include-toggle-status {
      color: rgba(0, 0, 0, 0.3);
    }
    
    body.home-active.theme-light .include-toggle-wrapper.active .include-toggle-status {
      color: #27ae60;
      text-shadow: 0 0 6px rgba(39, 174, 96, 0.3);
    }
    
    body.home-active.theme-light .include-toggle-track {
      background: rgba(0, 0, 0, 0.1);
    }
    
    body.home-active.theme-light .include-toggle input:checked + .include-toggle-track {
      background: rgba(39, 174, 96, 0.2);
      box-shadow: 0 0 8px rgba(39, 174, 96, 0.2), inset 0 0 3px rgba(39, 174, 96, 0.1);
    }
    
    body.home-active.theme-light .include-toggle-thumb {
      background: rgba(0, 0, 0, 0.25);
    }
    
    body.home-active.theme-light .include-toggle input:checked + .include-toggle-track .include-toggle-thumb {
      background: #27ae60;
      box-shadow: 0 2px 5px rgba(39, 174, 96, 0.35);
    }
    
    /* Badges en modo claro - Mejor contraste */
    body.home-active.theme-light .lead-state-badge.green {
      background: rgba(34, 197, 94, 0.15);
      color: #15803d;
      border-color: rgba(34, 197, 94, 0.4);
    }
    
    body.home-active.theme-light .lead-state-badge.red {
      background: rgba(239, 68, 68, 0.15);
      color: #b91c1c;
      border-color: rgba(239, 68, 68, 0.4);
    }
    
    body.home-active.theme-light .lead-test-badge {
      background: rgba(168, 85, 247, 0.15);
      color: #7c3aed;
      border-color: rgba(168, 85, 247, 0.4);
    }
    
    body.home-active.theme-light .lead-toolbar {
      border-top-color: rgba(0, 0, 0, 0.1);
    }
    
    body.home-active.theme-light .toolbar-btn {
      background: rgba(0, 0, 0, 0.06);
      border-color: rgba(0, 0, 0, 0.1);
      color: #1a1a1a;
    }
    
    body.home-active.theme-light .toolbar-btn:hover {
      background: rgba(0, 0, 0, 0.1);
    }
    
    body.home-active.theme-light .lead-info-card {
      background: rgba(255, 255, 255, 0.5);
      border-color: rgba(0, 0, 0, 0.1);
    }
    
    body.home-active.theme-light .lead-info-card h3 {
      color: rgba(0, 0, 0, 0.5);
      border-bottom-color: rgba(0, 0, 0, 0.1);
    }
    
    body.home-active.theme-light .info-row {
      border-bottom-color: rgba(0, 0, 0, 0.05);
    }
    
    body.home-active.theme-light .info-row-label {
      color: rgba(0, 0, 0, 0.5);
    }
    
    body.home-active.theme-light .info-row-value {
      color: #1a1a1a;
    }
    
    body.home-active.theme-light .date-input {
      background: rgba(0, 0, 0, 0.06);
      border-color: rgba(0, 0, 0, 0.15);
      color: #1a1a1a;
    }
    
    body.home-active.theme-light .date-input:hover, 
    body.home-active.theme-light .date-input:focus {
      border-color: rgba(0, 0, 0, 0.3);
      background: rgba(0, 0, 0, 0.1);
    }
    
    body.home-active.theme-light .fico-score {
      color: #2563eb;
    }
    
    body.home-active.theme-light .fico-score.pendiente {
      color: rgba(0, 0, 0, 0.4);
    }
    
    body.home-active.theme-light .liquid-glass-input {
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.8) 0%, 
        rgba(255, 255, 255, 0.6) 100%
      );
      border-color: rgba(0, 0, 0, 0.15);
      color: #1a1a1a;
    }
    
    body.home-active.theme-light .liquid-glass-input:hover {
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.9) 0%, 
        rgba(255, 255, 255, 0.7) 100%
      );
      border-color: rgba(0, 0, 0, 0.25);
    }
    
    body.home-active.theme-light .liquid-glass-input:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 20px rgba(59, 130, 246, 0.2);
    }
    
    /* Toast notifications fix for light mode */
    body.home-active.theme-light .toast {
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.95) 0%, 
        rgba(255, 255, 255, 0.85) 100%
      );
      border: 1px solid rgba(0, 0, 0, 0.1);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
      color: #1a1a1a;
    }
    
    body.home-active.theme-light .toast span {
      color: #1a1a1a;
    }
    
    /* Notification Modal */
    .notif-modal {
      position: fixed;
      inset: 0;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .notif-modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }
    
    .notif-modal-content {
      position: relative;
      width: 90%;
      max-width: 420px;
      background: linear-gradient(135deg, 
        rgba(30, 30, 40, 0.95) 0%, 
        rgba(20, 20, 30, 0.98) 100%
      );
      backdrop-filter: blur(40px);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 24px 64px rgba(0, 0, 0, 0.4);
      animation: modalSlideIn 0.3s ease;
    }
    
    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    .notif-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .notif-modal-header h3 {
      margin: 0;
      font-size: 1.1rem;
      color: white;
      font-weight: 600;
    }
    
    .notif-modal-close {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 8px;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: rgba(255, 255, 255, 0.7);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .notif-modal-close:hover {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }
    
    .notif-modal-close svg {
      width: 18px;
      height: 18px;
    }
    
    .notif-modal-body {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .notif-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      transition: all 0.2s ease;
    }
    
    .notif-item:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(255, 255, 255, 0.15);
      transform: translateX(4px);
    }
    
    .notif-item.today {
      background: rgba(34, 197, 94, 0.1);
      border-color: rgba(34, 197, 94, 0.3);
    }
    
    .notif-item-pin {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, 
        rgba(34, 197, 94, 0.3) 0%, 
        rgba(34, 197, 94, 0.15) 100%
      );
      border: 1px solid rgba(34, 197, 94, 0.4);
      border-radius: 50%;
      color: #4ade80;
      flex-shrink: 0;
    }
    
    .notif-item-pin svg {
      width: 18px;
      height: 18px;
    }
    
    .notif-item-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    
    .notif-item-name {
      color: white;
      font-weight: 500;
      font-size: 0.95rem;
    }
    
    .notif-item-date {
      color: rgba(255, 255, 255, 0.5);
      font-size: 0.8rem;
    }
    
    .notif-item-date.today-badge {
      color: #4ade80;
      font-weight: 600;
    }
    
    .notif-item-link {
      padding: 8px 16px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: white;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
    }
    
    .notif-item-link:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.3);
    }
    
    /* Light mode for notification modal */
    body.home-active.theme-light .notif-modal-content {
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.98) 0%, 
        rgba(245, 245, 250, 0.99) 100%
      );
      border-color: rgba(0, 0, 0, 0.1);
    }
    
    body.home-active.theme-light .notif-modal-header h3 {
      color: #1a1a1a;
    }
    
    body.home-active.theme-light .notif-modal-close {
      background: rgba(0, 0, 0, 0.08);
      color: rgba(0, 0, 0, 0.6);
    }
    
    body.home-active.theme-light .notif-modal-close:hover {
      background: rgba(0, 0, 0, 0.12);
      color: #1a1a1a;
    }
    
    body.home-active.theme-light .notif-item {
      background: rgba(0, 0, 0, 0.03);
      border-color: rgba(0, 0, 0, 0.08);
    }
    
    body.home-active.theme-light .notif-item:hover {
      background: rgba(0, 0, 0, 0.06);
    }
    
    body.home-active.theme-light .notif-item.today {
      background: rgba(34, 197, 94, 0.08);
      border-color: rgba(34, 197, 94, 0.25);
    }
    
    body.home-active.theme-light .notif-item-name {
      color: #1a1a1a;
    }
    
    body.home-active.theme-light .notif-item-date {
      color: rgba(0, 0, 0, 0.5);
    }
    
    body.home-active.theme-light .notif-item-link {
      background: rgba(0, 0, 0, 0.06);
      border-color: rgba(0, 0, 0, 0.12);
      color: #1a1a1a;
    }
    
    body.home-active.theme-light .notif-item-link:hover {
      background: rgba(0, 0, 0, 0.1);
    }
    
    /* Light mode for custom calendar */
    body.home-active.theme-light .custom-calendar {
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.98) 0%, 
        rgba(245, 245, 250, 0.99) 100%
      );
      border-color: rgba(0, 0, 0, 0.12);
      box-shadow: 
        0 24px 64px rgba(0, 0, 0, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.5);
    }
    
    body.home-active.theme-light .calendar-title {
      color: #1a1a1a;
    }
    
    body.home-active.theme-light .calendar-nav {
      background: rgba(0, 0, 0, 0.06);
      border-color: rgba(0, 0, 0, 0.1);
      color: #1a1a1a;
    }
    
    body.home-active.theme-light .calendar-nav:hover {
      background: rgba(0, 0, 0, 0.1);
    }
    
    body.home-active.theme-light .calendar-weekdays span {
      color: rgba(0, 0, 0, 0.4);
    }
    
    body.home-active.theme-light .calendar-day {
      color: rgba(0, 0, 0, 0.8);
    }
    
    body.home-active.theme-light .calendar-day.other-month {
      color: rgba(0, 0, 0, 0.3);
    }
    
    body.home-active.theme-light .calendar-day:hover {
      background: rgba(0, 0, 0, 0.05);
      border-color: rgba(0, 0, 0, 0.1);
    }
    
    body.home-active.theme-light .calendar-day.today {
      background: rgba(59, 130, 246, 0.1);
      border-color: rgba(59, 130, 246, 0.3);
      color: #2563eb;
    }
    
    body.home-active.theme-light .calendar-day.selected {
      background: linear-gradient(135deg, 
        rgba(34, 197, 94, 0.2) 0%, 
        rgba(34, 197, 94, 0.1) 100%
      );
      border-color: rgba(34, 197, 94, 0.4);
      color: #16a34a;
    }
    
    body.home-active.theme-light .calendar-day.selected::after {
      background: #22c55e;
    }
    
    body.home-active.theme-light .liquid-glass-btn {
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.9) 0%, 
        rgba(255, 255, 255, 0.7) 100%
      );
      border-color: rgba(0, 0, 0, 0.12);
      color: #1a1a1a;
      box-shadow: 
        0 4px 24px rgba(0, 0, 0, 0.08),
        inset 0 1px 0 rgba(255, 255, 255, 0.5);
    }
    
    body.home-active.theme-light .liquid-glass-btn:hover {
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 1) 0%, 
        rgba(255, 255, 255, 0.85) 100%
      );
      border-color: rgba(0, 0, 0, 0.2);
    }
    
    body.home-active.theme-light .callback-mac-btn {
      background: #22c55e;
    }
    
    body.home-active.theme-light .callback-mac-btn:hover {
      background: #16a34a;
    }
    
    body.home-active.theme-light {
      background: #f5f5f7;
    }
  </style>
</head>
<body class="home-active theme-dark">
  <div class="page-bg"></div>
  <div class="page-overlay"></div>
  
  <main class="lead-view-wrapper">
    <div class="lead-floating">
      <!-- Logo -->
      <img class="lead-logo" src="reference/CD logo.png" alt="Cero Deuda" />
      
      <!-- TOOLBAR - Copiado idéntico del dashboard -->
      <div id="toolbarWrap" class="toolbar-wrap" aria-label="Barra de accesos">
        <div id="toolbarShell" class="toolbar-shell">
          <div class="toolbar-glass-container">
            <div class="toolbar-glass-bg"></div>
            
            <div class="toolbar-content">
              <div class="toolbar-group toolbar-left" aria-label="Accesos izquierda">
                <button id="leadsBtn" class="tool-btn" type="button" aria-label="Leads" onclick="window.location.href='index.html#leads'">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="6" cy="7" r="2.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M2 18C2 15.2386 4.23858 13 7 13H7.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="18" cy="7" r="2.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M22 18C22 15.2386 19.7614 13 17 13H16.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="12" cy="9" r="3" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M5 21C5 17.134 8.13401 14 12 14C15.866 14 19 17.134 19 21" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <span>Leads</span>
                </button>

                <button class="tool-btn" type="button" aria-label="Calendario">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <rect x="3" y="5" width="18" height="16" rx="3" />
                    <path d="M3 9h18M8 3v4M16 3v4" />
                  </svg>
                  <span>Calendario</span>
                </button>
              </div>

              <div class="search-central-unit">
                <label class="home-search-shell search" for="homeSearch">
                  <svg class="search-glyph" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M10.5 3.5a7 7 0 1 0 4.49 12.37l4.32 4.31 1.41-1.41-4.31-4.32A7 7 0 0 0 10.5 3.5Zm0 2a5 5 0 1 1 0 10 5 5 0 0 1 0-10Z" />
                  </svg>
                  <input
                    id="homeSearch"
                    class="home-search-input"
                    type="search"
                    placeholder="Buscar cliente..."
                    aria-label="Buscar"
                  />
                </label>

                <button
                  id="toolbarToggle"
                  class="toolbar-toggle"
                  type="button"
                  aria-label="Mostrar accesos"
                  aria-expanded="false"
                >
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 12H21M3 6H21M3 18H21" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>

              <div class="toolbar-group toolbar-right" aria-label="Accesos derecha">
                <button class="tool-btn" type="button" aria-label="Notificaciones">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <path d="M12 3a5 5 0 0 0-5 5v2.2c0 1.1-.4 2.1-1.1 2.9L4.8 14.3a1 1 0 0 0 .7 1.7h13a1 1 0 0 0 .7-1.7l-1.1-1.2a4.2 4.2 0 0 1-1.1-2.9V8a5 5 0 0 0-5-5Z" />
                    <path d="M10 18a2 2 0 0 0 4 0" />
                  </svg>
                  <span>Notifs</span>
                </button>

                <button class="tool-btn" type="button" aria-label="Correos">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <rect x="3" y="5" width="18" height="14" rx="2" />
                    <path d="m4 7 8 6 8-6" />
                  </svg>
                  <span>Correos</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Account Actions -->
      <div class="home-actions" aria-label="Cuenta y ajustes">
        <button
          id="accountBtn"
          class="account-icon-btn"
          type="button"
          aria-label="Cuenta"
          aria-haspopup="true"
          aria-expanded="false"
        >
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="8" r="4" stroke="white" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M4 20C4 16.6863 6.68629 14 10 14H14C17.3137 14 20 16.6863 20 20" stroke="white" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>

        <div id="accountMenu" class="account-menu hidden" role="menu" aria-label="Ajustes de cuenta">
          <p class="account-menu-title">Ajustes rapidos</p>

          <label class="theme-inline-toggle" for="themeSwitch" aria-label="Cambiar tema">
            <input id="themeSwitch" class="theme-switch-input" type="checkbox" aria-label="Toggle de tema" />
            
            <svg class="icon icon-moon-side" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M21 12.79A9 9 0 1 1 11.21 3c.49 0 .74.59.38.93A7 7 0 0 0 20.07 11.4c.34-.36.93-.11.93.39Z" />
            </svg>

            <span class="theme-switch-track" aria-hidden="true">
              <span class="theme-switch-thumb"></span>
            </span>

            <svg class="icon icon-sun-side" viewBox="0 0 24 24" aria-hidden="true">
              <circle cx="12" cy="12" r="4" />
              <path d="M12 2v2.2M12 19.8V22M22 12h-2.2M4.2 12H2M19.07 4.93l-1.56 1.56M6.49 17.51l-1.56 1.56M19.07 19.07l-1.56-1.56M6.49 6.49 4.93 4.93" />
            </svg>
          </label>

          <div class="account-menu-divider" role="separator"></div>

          <button id="logoutBtn" class="logout-btn" type="button" role="menuitem">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
              <polyline points="16 17 21 12 16 7" />
              <line x1="21" y1="12" x2="9" y2="12" />
            </svg>
            <span>Cerrar sesión</span>
          </button>
        </div>
      </div>

      <!-- CONTENIDO DEL LEAD -->
      <div class="lead-content-area">
        <header class="lead-header">
          <div class="lead-title-section">
            <!-- Nombre editable -->
            <div class="lead-name-wrapper">
              <!-- Botón de cambio Applicant/Co-Applicant -->
              <button id="applicantToggleBtn" class="applicant-toggle-btn" title="Cambiar a Co-Applicant">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M7 10h14l-4-4"/>
                  <path d="M17 14H3l4 4"/>
                </svg>
              </button>
              <span id="applicantTypeLabel" class="applicant-type-label">Applicant</span>
              
              <h1 id="leadName" class="lead-name-text" contenteditable="false" title="Click para editar"></h1>
              
              <!-- Botón de copiar nombre - solo icono, sin box -->
              <button id="copyNameBtn" class="copy-btn" title="Copiar nombre">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                </svg>
              </button>
            </div>
            
            <!-- Badge de State Type (Green/Red) -->
            <span id="stateBadge" class="lead-state-badge"></span>
            
            <!-- Badge de Test (si aplica) -->
            <span id="testBadge" class="lead-test-badge hidden">Test</span>
          </div>
          
          <!-- Case ID debajo del nombre -->
          <div class="lead-case-id">
            <span class="case-label">Case ID:</span>
            <span id="caseNumber" class="case-number"></span>
            <button id="copyCaseBtn" class="copy-icon-btn" title="Copiar Case ID">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
              </svg>
            </button>
            
            <!-- Toggle Include Co-Applicant (solo visible en modo Co-Applicant) -->
            <div id="includeCoAppToggleWrapper" class="include-toggle-wrapper hidden">
              <span id="includeToggleStatus" class="include-toggle-status">OFF</span>
              <label class="include-toggle">
                <input type="checkbox" id="includeCoAppToggle">
                <span class="include-toggle-track">
                  <span class="include-toggle-thumb"></span>
                </span>
              </label>
            </div>
          </div>
          
          <!-- Toolbar de acciones -->
          <div class="lead-toolbar">
            <button class="toolbar-btn back-btn" onclick="window.location.href='index.html#leads'">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
              </svg>
              Volver
            </button>
            
            <button class="toolbar-btn">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/>
              </svg>
              Llamar
            </button>
            
            <button class="toolbar-btn">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                <polyline points="22,6 12,13 2,6"/>
              </svg>
              Email
            </button>
            
            <button class="toolbar-btn">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
              </svg>
              Notas
            </button>
          </div>
        </header>
        
        <!-- Contenido dinámico -->
        <div id="leadContent" class="lead-content-grid">
          <div class="loading">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48 2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48 2.83-2.83"/>
            </svg>
            <p>Cargando información del cliente...</p>
          </div>
        </div>
      </div>
    </div>
  </main>
  
  <script>
    // ============================================
    // TEMA
    // ============================================
    const THEME_KEY = 'project_gw_theme';
    const savedTheme = localStorage.getItem(THEME_KEY) || 'dark';
    document.body.classList.remove('theme-dark', 'theme-light');
    document.body.classList.add(`theme-${savedTheme}`);
    
    const themeSwitch = document.getElementById('themeSwitch');
    if (themeSwitch) {
      themeSwitch.checked = savedTheme === 'light';
      themeSwitch.addEventListener('change', () => {
        const newTheme = themeSwitch.checked ? 'light' : 'dark';
        document.body.classList.remove('theme-dark', 'theme-light');
        document.body.classList.add(`theme-${newTheme}`);
        localStorage.setItem(THEME_KEY, newTheme);
      });
    }
    
    // ============================================
    // MENU DE CUENTA
    // ============================================
    const accountBtn = document.getElementById('accountBtn');
    const accountMenu = document.getElementById('accountMenu');
    
    if (accountBtn && accountMenu) {
      accountBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        const isOpen = accountMenu.classList.toggle('hidden');
        accountBtn.setAttribute('aria-expanded', !isOpen);
      });
      
      document.addEventListener('click', () => {
        accountMenu.classList.add('hidden');
        accountBtn.setAttribute('aria-expanded', 'false');
      });
    }
    
    // Cerrar sesión
    const logoutBtn = document.getElementById('logoutBtn');
    if (logoutBtn) {
      logoutBtn.addEventListener('click', () => {
        localStorage.removeItem('project_gw_session');
        window.location.href = 'index.html';
      });
    }
    
    // ============================================
    // TOOLBAR TOGGLE
    // ============================================
    const toolbarToggle = document.getElementById('toolbarToggle');
    const toolbarWrap = document.getElementById('toolbarWrap');
    
    if (toolbarToggle && toolbarWrap) {
      toolbarToggle.addEventListener('click', (e) => {
        e.stopPropagation();
        const isOpen = toolbarWrap.classList.toggle('expanded');
        toolbarToggle.setAttribute('aria-expanded', isOpen);
      });
    }
    
    // ============================================
    // NOMBRE EDITABLE Y COPIAR
    // ============================================
    const leadNameEl = document.getElementById('leadName');
    const copyNameBtn = document.getElementById('copyNameBtn');
    const caseNumberEl = document.getElementById('caseNumber');
    const copyCaseBtn = document.getElementById('copyCaseBtn');
    let originalName = '';
    let caseIdValue = '';
    
    // Manejo de Applicant / Co-Applicant
    let isApplicant = true;
    let applicantData = { fullName: '', phone: '', email: '', dob: '', ssn: '' };
    let coApplicantData = { fullName: '', phone: '', email: '', dob: '', ssn: '' };
    
    const applicantToggleBtn = document.getElementById('applicantToggleBtn');
    const applicantTypeLabel = document.getElementById('applicantTypeLabel');
    
    if (applicantToggleBtn && applicantTypeLabel) {
      // Elementos del toggle "Incluir en contrato"
      const includeToggleWrapper = document.getElementById('includeCoAppToggleWrapper');
      const includeToggle = document.getElementById('includeCoAppToggle');
      const includeToggleStatus = document.getElementById('includeToggleStatus');
      
      // Función para actualizar el estado visual del toggle
      function updateToggleVisualState() {
        if (includeToggleWrapper && includeToggle && includeToggleStatus) {
          const isChecked = includeToggle.checked;
          includeToggleWrapper.classList.toggle('active', isChecked);
          includeToggleStatus.textContent = isChecked ? 'ON' : 'OFF';
        }
      }
      
      applicantToggleBtn.addEventListener('click', () => {
        // Guardar datos actuales antes de cambiar
        if (isApplicant) {
          applicantData.fullName = leadNameEl ? leadNameEl.textContent.trim() : '';
        } else {
          coApplicantData.fullName = leadNameEl ? leadNameEl.textContent.trim() : '';
        }
        
        // Cambiar estado
        isApplicant = !isApplicant;
        
        // Rotar botón
        applicantToggleBtn.classList.toggle('rotated', !isApplicant);
        
        // Actualizar etiqueta y estilos
        if (isApplicant) {
          applicantTypeLabel.textContent = 'Applicant';
          applicantTypeLabel.classList.remove('co-applicant');
          applicantToggleBtn.title = 'Cambiar a Co-Applicant';
          
          // Ocultar toggle de "Incluir en contrato"
          if (includeToggleWrapper) {
            includeToggleWrapper.classList.add('hidden');
          }
          
          // Restaurar datos del Applicant
          if (leadNameEl) {
            leadNameEl.textContent = applicantData.fullName || originalName;
          }
        } else {
          applicantTypeLabel.textContent = 'Co-Applicant';
          applicantTypeLabel.classList.add('co-applicant');
          applicantToggleBtn.title = 'Cambiar a Applicant';
          
          // Mostrar toggle de "Incluir en contrato"
          if (includeToggleWrapper) {
            includeToggleWrapper.classList.remove('hidden');
            updateToggleVisualState();
          }
          
          // Mostrar datos del Co-Applicant
          if (leadNameEl) {
            leadNameEl.textContent = coApplicantData.fullName || 'Nuevo Co-Applicant';
          }
        }
        
        showToast(`Cambiado a ${isApplicant ? 'Applicant' : 'Co-Applicant'}`, 'info');
      });
      
      // Event listener para el toggle "Incluir en contrato"
      if (includeToggle) {
        includeToggle.addEventListener('change', () => {
          updateToggleVisualState();
          showToast(
            includeToggle.checked 
              ? 'Co-Applicant será incluido en el contrato' 
              : 'Co-Applicant no será incluido en el contrato', 
            includeToggle.checked ? 'success' : 'info'
          );
        });
      }
    }
    
    // Hacer el nombre editable al hacer click
    if (leadNameEl) {
      leadNameEl.addEventListener('click', () => {
        if (leadNameEl.contentEditable === 'false') {
          leadNameEl.contentEditable = 'true';
          leadNameEl.classList.add('editing');
          leadNameEl.focus();
          
          // Seleccionar todo el texto
          const range = document.createRange();
          range.selectNodeContents(leadNameEl);
          const sel = window.getSelection();
          sel.removeAllRanges();
          sel.addRange(range);
        }
      });
      
      // Guardar al perder foco o presionar Enter
      leadNameEl.addEventListener('blur', () => {
        saveName();
      });
      
      leadNameEl.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          leadNameEl.blur();
        } else if (e.key === 'Escape') {
          leadNameEl.textContent = originalName;
          leadNameEl.blur();
        }
      });
    }
    
    async function saveName() {
      if (!leadNameEl) return;
      
      leadNameEl.contentEditable = 'false';
      leadNameEl.classList.remove('editing');
      
      const newName = leadNameEl.textContent.trim();
      const currentOriginal = isApplicant ? originalName : (coApplicantData.fullName || '');
      
      if (newName && newName !== currentOriginal) {
        try {
          // Obtener el ID del lead de la URL
          const urlParams = new URLSearchParams(window.location.search);
          const leadId = urlParams.get('id');
          
          if (!leadId) {
            showToast('Error: No se encontró el ID del lead', 'error');
            leadNameEl.textContent = currentOriginal;
            return;
          }
          
          // Guardar en memoria según el tipo
          if (isApplicant) {
            applicantData.fullName = newName;
          } else {
            coApplicantData.fullName = newName;
          }
          
          // Llamada al backend para actualizar
          const response = await fetch(`/api/leads/${leadId}`, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
              fullName: isApplicant ? newName : originalName,
              coApplicantName: isApplicant ? (coApplicantData.fullName || '') : newName
            })
          });
          
          if (!response.ok) {
            throw new Error('Error al actualizar');
          }
          
          if (isApplicant) {
            originalName = newName;
          }
          
          showToast(`${isApplicant ? 'Applicant' : 'Co-Applicant'} actualizado correctamente`, 'success');
        } catch (error) {
          console.error('Error:', error);
          showToast('Error al actualizar el nombre', 'error');
          leadNameEl.textContent = currentOriginal;
        }
      } else {
        leadNameEl.textContent = currentOriginal;
      }
    }
    
    // Botón de copiar nombre (con box)
    if (copyNameBtn) {
      copyNameBtn.addEventListener('click', async () => {
        const name = leadNameEl ? leadNameEl.textContent.trim() : '';
        if (name) {
          try {
            await navigator.clipboard.writeText(name);
            copyNameBtn.classList.add('copied');
            copyNameBtn.innerHTML = `
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
            `;
            
            setTimeout(() => {
              copyNameBtn.classList.remove('copied');
              copyNameBtn.innerHTML = `
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                </svg>
              `;
            }, 2000);
          } catch (err) {
            console.error('Error al copiar:', err);
          }
        }
      });
    }
    
    // Botón de copiar Case ID (solo icono, sin box)
    if (copyCaseBtn) {
      copyCaseBtn.addEventListener('click', async () => {
        if (caseIdValue) {
          try {
            await navigator.clipboard.writeText(caseIdValue);
            copyCaseBtn.classList.add('copied');
            copyCaseBtn.innerHTML = `
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
            `;
            
            setTimeout(() => {
              copyCaseBtn.classList.remove('copied');
              copyCaseBtn.innerHTML = `
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                </svg>
              `;
            }, 2000);
          } catch (err) {
            console.error('Error al copiar:', err);
          }
        }
      });
    }
    
    // ============================================
    // TOAST NOTIFICATIONS
    // ============================================
    function showToast(message, type = 'info') {
      let container = document.getElementById('toastContainer');
      if (!container) {
        container = document.createElement('div');
        container.id = 'toastContainer';
        container.className = 'toast-container';
        document.body.appendChild(container);
      }
      
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      
      const iconSvg = type === 'success' 
        ? '<svg viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2" width="20" height="20"><path d="M5 13l4 4L19 7"/></svg>'
        : '<svg viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2" width="20" height="20"><circle cx="12" cy="12" r="10"/><path d="M12 7v6m0 4v-2"/></svg>';
      
      toast.innerHTML = `${iconSvg}<span>${message}</span>`;
      container.appendChild(toast);
      
      setTimeout(() => {
        toast.classList.add('hide');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }
    
    // ============================================
    // CUSTOM CALENDAR - LIQUID GLASS
    // ============================================
    let currentCalendarDate = new Date();
    let selectedCallbackDate = null;
    let calendarLeadId = null;
    let calendarLeadName = '';
    
    function initCallbackCalendar(leadId, leadName) {
      calendarLeadId = leadId;
      calendarLeadName = leadName;
      
      const calendarBtn = document.getElementById('callbackCalendarBtn');
      const calendarEl = document.getElementById('customCalendar');
      const dateDisplay = document.getElementById('callbackDateDisplay');
      const macBtn = document.getElementById('callbackMacBtn');
      
      // Cargar fecha guardada
      const savedCallback = localStorage.getItem(`lead_callback_${leadId}`);
      if (savedCallback) {
        selectedCallbackDate = savedCallback;
        dateDisplay.textContent = new Date(savedCallback).toLocaleDateString('es-ES');
        if (macBtn) macBtn.classList.remove('hidden');
      }
      
      function openCalendar() {
        calendarEl.classList.remove('hidden');
        renderCalendar();
      }
      
      function closeCalendar() {
        calendarEl.classList.add('hidden');
      }
      
      // Abrir/cerrar calendario
      if (calendarBtn) {
        calendarBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          if (calendarEl.classList.contains('hidden')) {
            openCalendar();
          } else {
            closeCalendar();
          }
        });
      }
      
      // Cerrar al hacer click fuera
      document.addEventListener('click', (e) => {
        if (!calendarEl.contains(e.target) && !calendarBtn.contains(e.target)) {
          closeCalendar();
        }
      });
      
      // Navegación del calendario
      document.getElementById('calendarPrev').addEventListener('click', (e) => {
        e.stopPropagation();
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
        renderCalendar();
      });
      
      document.getElementById('calendarNext').addEventListener('click', (e) => {
        e.stopPropagation();
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
        renderCalendar();
      });
      
      // Botón Mac para eliminar callback
      if (macBtn) {
        macBtn.addEventListener('click', () => {
          selectedCallbackDate = null;
          localStorage.removeItem(`lead_callback_${leadId}`);
          localStorage.removeItem(`lead_callback_name_${leadId}`);
          macBtn.classList.add('hidden');
          dateDisplay.textContent = 'Seleccionar fecha';
          showToast('Callback eliminado', 'info');
          updateNotificationBadge();
          renderCalendar();
        });
      }
    }
    
    function renderCalendar() {
      const year = currentCalendarDate.getFullYear();
      const month = currentCalendarDate.getMonth();
      
      // Actualizar título
      const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                          'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
      document.getElementById('calendarMonthYear').textContent = `${monthNames[month]} ${year}`;
      
      const daysContainer = document.getElementById('calendarDays');
      daysContainer.innerHTML = '';
      
      // Primer día del mes
      const firstDay = new Date(year, month, 1).getDay();
      // Días en el mes
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      // Días en el mes anterior
      const daysInPrevMonth = new Date(year, month, 0).getDate();
      
      // Días del mes anterior
      for (let i = firstDay - 1; i >= 0; i--) {
        const dayEl = document.createElement('button');
        dayEl.className = 'calendar-day other-month';
        dayEl.textContent = daysInPrevMonth - i;
        daysContainer.appendChild(dayEl);
      }
      
      // Días del mes actual
      const today = new Date().toISOString().split('T')[0];
      
      for (let i = 1; i <= daysInMonth; i++) {
        const dayEl = document.createElement('button');
        dayEl.className = 'calendar-day';
        dayEl.textContent = i;
        
        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
        
        // Marcar hoy
        if (dateStr === today) {
          dayEl.classList.add('today');
        }
        
        // Marcar seleccionado
        if (dateStr === selectedCallbackDate) {
          dayEl.classList.add('selected');
        }
        
        // Verificar si hay callback en este día para este lead
        if (dateStr === localStorage.getItem(`lead_callback_${calendarLeadId}`)) {
          dayEl.classList.add('has-pin');
        }
        
        dayEl.addEventListener('click', () => {
          selectedCallbackDate = dateStr;
          localStorage.setItem(`lead_callback_${calendarLeadId}`, dateStr);
          localStorage.setItem(`lead_callback_name_${calendarLeadId}`, calendarLeadName);
          
          document.getElementById('callbackDateDisplay').textContent = new Date(dateStr).toLocaleDateString('es-ES');
          const mb = document.getElementById('callbackMacBtn');
          if (mb) mb.classList.remove('hidden');
          
          showToast(`Callback programado para: ${new Date(dateStr).toLocaleDateString('es-ES')}`, 'success');
          updateNotificationBadge();
          renderCalendar();
          // El calendario se mantiene abierto para permitir cambiar la fecha si se desea
        });
        
        daysContainer.appendChild(dayEl);
      }
      
      // Días del mes siguiente (solo para completar la última fila)
      const totalCells = firstDay + daysInMonth;
      const remainingCells = (Math.ceil(totalCells / 7) * 7) - totalCells;
      for (let i = 1; i <= remainingCells; i++) {
        const dayEl = document.createElement('button');
        dayEl.className = 'calendar-day other-month';
        dayEl.textContent = i;
        daysContainer.appendChild(dayEl);
      }
    }
    
    // ============================================
    // NOTIFICACIONES DE CALLBACK
    // ============================================
    function getAllCallbacks() {
      const callbacks = [];
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('lead_callback_') && !key.includes('_name_')) {
          const leadId = key.replace('lead_callback_', '');
          const date = localStorage.getItem(key);
          const name = localStorage.getItem(`lead_callback_name_${leadId}`) || `Lead #${leadId}`;
          if (date) {
            callbacks.push({ leadId, date, name });
          }
        }
      }
      return callbacks.sort((a, b) => new Date(a.date) - new Date(b.date));
    }
    
    function updateNotificationBadge() {
      const callbacks = getAllCallbacks();
      const today = new Date().toISOString().split('T')[0];
      const todayCallbacks = callbacks.filter(cb => cb.date === today);
      
      // Buscar el botón de notificaciones en el toolbar
      const notifBtn = document.querySelector('.tool-btn[aria-label="Notificaciones"]');
      if (notifBtn) {
        // Remover badge anterior si existe
        const existingBadge = notifBtn.querySelector('.notif-badge');
        if (existingBadge) existingBadge.remove();
        
        // Agregar nuevo badge si hay callbacks para hoy
        if (todayCallbacks.length > 0) {
          const badge = document.createElement('span');
          badge.className = 'notif-badge';
          badge.textContent = todayCallbacks.length;
          badge.style.cssText = `
            position: absolute;
            top: -4px;
            right: -4px;
            background: #ef4444;
            color: white;
            font-size: 0.7rem;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
          `;
          notifBtn.style.position = 'relative';
          notifBtn.appendChild(badge);
        }
      }
    }
    
    function showCallbackNotifications() {
      const callbacks = getAllCallbacks();
      const today = new Date().toISOString().split('T')[0];
      const upcoming = callbacks.filter(cb => cb.date >= today);
      
      if (upcoming.length === 0) {
        showToast('No hay callbacks programados', 'info');
        return;
      }
      
      // Crear modal de notificaciones
      let notifModal = document.getElementById('callbackNotifModal');
      if (notifModal) notifModal.remove();
      
      notifModal = document.createElement('div');
      notifModal.id = 'callbackNotifModal';
      notifModal.className = 'notif-modal';
      notifModal.innerHTML = `
        <div class="notif-modal-backdrop"></div>
        <div class="notif-modal-content">
          <div class="notif-modal-header">
            <h3>📞 Callbacks Programados</h3>
            <button class="notif-modal-close" onclick="this.closest('.notif-modal').remove()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
          </div>
          <div class="notif-modal-body">
            ${upcoming.map(cb => {
              const isToday = cb.date === today;
              const dateObj = new Date(cb.date);
              const dateStr = dateObj.toLocaleDateString('es-ES', { weekday: 'short', month: 'short', day: 'numeric' });
              return `
                <div class="notif-item ${isToday ? 'today' : ''}">
                  <div class="notif-item-pin">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                      <circle cx="12" cy="10" r="3"/>
                    </svg>
                  </div>
                  <div class="notif-item-info">
                    <span class="notif-item-name">${escapeHtml(cb.name)}</span>
                    <span class="notif-item-date ${isToday ? 'today-badge' : ''}">${isToday ? '📅 HOY - ' : ''}${dateStr}</span>
                  </div>
                  <button class="notif-item-link" onclick="window.location.href='/client.html?id=${cb.leadId}'">
                    Ver
                  </button>
                </div>
              `;
            }).join('')}
          </div>
        </div>
      `;
      
      document.body.appendChild(notifModal);
      
      // Cerrar al hacer click fuera
      notifModal.querySelector('.notif-modal-backdrop').addEventListener('click', () => {
        notifModal.remove();
      });
    }
    
    // Actualizar badge al cargar la página
    document.addEventListener('DOMContentLoaded', () => {
      updateNotificationBadge();
      
      // Conectar botón de notificaciones
      const notifBtn = document.querySelector('.tool-btn[aria-label="Notificaciones"]');
      if (notifBtn) {
        notifBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          showCallbackNotifications();
        });
      }
    });
    
    // ============================================
    // CARGAR DATOS DEL LEAD
    // ============================================
    async function loadLead() {
      const urlParams = new URLSearchParams(window.location.search);
      const leadId = urlParams.get('id');
      
      if (!leadId) {
        document.getElementById('leadContent').innerHTML = `
          <div class="error">
            <h2>Error</h2>
            <p>No se especificó un ID de cliente.</p>
          </div>
        `;
        return;
      }
      
      try {
        const response = await fetch(`/api/leads/${leadId}`);
        if (!response.ok) throw new Error('Lead no encontrado');
        
        const data = await response.json();
        const lead = data.lead;
        
        // Guardar valores originales
        originalName = lead.full_name;
        caseIdValue = String(lead.case_id);
        
        // Guardar datos de Co-Applicant si existe
        if (lead.co_applicant_name) {
          coApplicantData.fullName = lead.co_applicant_name;
        }
        
        // Setear nombre (Applicant por defecto)
        if (leadNameEl) {
          leadNameEl.textContent = lead.full_name;
        }
        
        // Setear Case ID
        if (caseNumberEl) {
          caseNumberEl.textContent = lead.case_id;
        }
        
        // Setear badge de estado (Green/Red)
        const stateBadge = document.getElementById('stateBadge');
        if (stateBadge) {
          const isGreen = lead.state_type === 'Green';
          stateBadge.className = `lead-state-badge ${isGreen ? 'green' : 'red'}`;
          stateBadge.textContent = lead.state_type;
          stateBadge.title = `${getStateName(lead.state_code)} (${lead.state_code}) - ${lead.state_type} State`;
        }
        
        // Badge de Test
        const testBadge = document.getElementById('testBadge');
        if (testBadge) {
          testBadge.classList.toggle('hidden', !lead.is_test);
        }
        
        // Renderizar contenido
        document.getElementById('leadContent').innerHTML = `
          <!-- Card 1: Información de Contacto -->
          <div class="lead-info-card">
            <h3>Información de Contacto</h3>
            <div class="info-row">
              <span class="info-row-label">Home Phone</span>
              <span class="info-row-value mono">${escapeHtml(lead.phone || 'No especificado')}</span>
            </div>
            <div class="info-row">
              <span class="info-row-label">Cell Phone</span>
              <span class="info-row-value mono">${escapeHtml(lead.phone || 'No especificado')}</span>
            </div>
            <div class="info-row">
              <span class="info-row-label">DOB</span>
              <span class="info-row-value">No especificado</span>
            </div>
            <div class="info-row">
              <span class="info-row-label">Email</span>
              <span class="info-row-value">${escapeHtml(lead.email || 'No especificado')}</span>
            </div>
            <div class="info-row">
              <span class="info-row-label">SSN / ITIN</span>
              <span class="info-row-value mono">***-**-****</span>
            </div>
          </div>
          
          <!-- Card 2: Dirección & WC -->
          <div class="lead-info-card">
            <h3>DIRECCIÓN & WC</h3>
            <div class="info-row">
              <span class="info-row-label">Address Street</span>
              <span class="info-row-value">No especificado</span>
            </div>
            <div class="info-row">
              <span class="info-row-label">City</span>
              <span class="info-row-value">No especificado</span>
            </div>
            <div class="info-row">
              <span class="info-row-label">ZIP Code</span>
              <span class="info-row-value mono">No especificado</span>
            </div>
            <div class="info-row">
              <span class="info-row-label">State</span>
              <span class="info-row-value">${lead.state_code ? `${getStateName(lead.state_code)} (${lead.state_code})` : 'No especificado'}</span>
            </div>
            <div class="info-row">
              <span class="info-row-label">Best time to call</span>
              <span class="info-row-value">No especificado</span>
            </div>
          </div>
          
          <!-- Card 3: Employment Details -->
          <div class="lead-info-card">
            <h3>EMPLOYMENT DETAILS</h3>
            <div class="info-row">
              <span class="info-row-label">Currently employed</span>
              <span class="info-row-value">No especificado</span>
            </div>
            <div class="info-row">
              <span class="info-row-label">Employer name</span>
              <span class="info-row-value">No especificado</span>
            </div>
            <div class="info-row">
              <span class="info-row-label">Occupation</span>
              <span class="info-row-value">No especificado</span>
            </div>
            <div class="info-row">
              <span class="info-row-label">Self Employed</span>
              <span class="info-row-value">No especificado</span>
            </div>
          </div>
          
          <!-- Card 2: Tiempos y Fechas (Expandido) -->
          <div class="lead-info-card lead-info-card-wide">
            <h3>Tiempos y Fechas</h3>
            <div class="two-column-layout">
              <!-- Columna Izquierda -->
              <div class="info-column">
                <div class="info-row">
                  <span class="info-row-label">Fecha de Creación</span>
                  <span class="info-row-value">${new Date(lead.created_at).toLocaleString('es-ES')}</span>
                </div>
                <div class="info-row">
                  <span class="info-row-label">Assigned Date</span>
                  <span class="info-row-value">${lead.assigned_to ? new Date(lead.created_at).toLocaleDateString('es-ES') : 'Sin asignar'}</span>
                </div>
                <div class="info-row">
                  <span class="info-row-label">Close Date</span>
                  <span class="info-row-value" id="closeDateValue">${lead.status === 'Sent to Debt Manager' ? new Date(lead.updated_at).toLocaleDateString('es-ES') : 'Pendiente'}</span>
                </div>
                <div class="info-row">
                  <span class="info-row-label">Días en Status</span>
                  <span class="info-row-value">${calculateDaysInStatus(lead.created_at)}</span>
                </div>
              </div>
              
              <!-- Columna Derecha -->
              <div class="info-column">
                <div class="info-row">
                  <span class="info-row-label">Last Credit Pull</span>
                  <span class="info-row-value">${new Date(lead.created_at).toLocaleDateString('es-ES')}</span>
                </div>
                <div class="info-row">
                  <span class="info-row-label">Submitted Date</span>
                  <span class="info-row-value">${lead.status === 'Submitted to UW' ? new Date(lead.updated_at).toLocaleDateString('es-ES') : 'N/A'}</span>
                </div>
                <div class="info-row callback-row">
                  <span class="info-row-label">Callback</span>
                  <div class="callback-wrapper">
                    <button id="callbackCalendarBtn" class="calendar-trigger liquid-glass-btn">
                      <span id="callbackDateDisplay">Seleccionar fecha</span>
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                      </svg>
                    </button>
                    <button id="callbackMacBtn" class="callback-mac-btn hidden" title="Eliminar callback"></button>
                    
                    <!-- Calendario Custom Liquid Glass -->
                    <div id="customCalendar" class="custom-calendar hidden">
                      <div class="calendar-header">
                      <button id="calendarPrev" class="calendar-nav">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <polyline points="15 18 9 12 15 6"/>
                        </svg>
                      </button>
                      <span id="calendarMonthYear" class="calendar-title"></span>
                      <button id="calendarNext" class="calendar-nav">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <polyline points="9 18 15 12 9 6"/>
                        </svg>
                      </button>
                    </div>
                    <div class="calendar-weekdays">
                      <span>Dom</span><span>Lun</span><span>Mar</span><span>Mié</span>
                      <span>Jue</span><span>Vie</span><span>Sáb</span>
                    </div>
                    <div id="calendarDays" class="calendar-days"></div>
                  </div>
                </div>
                <div class="info-row">
                  <span class="info-row-label">FICO Score</span>
                  <span class="info-row-value fico-score" id="ficoScore">Pendiente</span>
                </div>
              </div>
            </div>
          </div>
        `;
        
        // Inicializar Callback Calendar después de renderizar
        initCallbackCalendar(leadId, lead.full_name);
        
      } catch (error) {
        console.error('Error cargando lead:', error);
        document.getElementById('leadContent').innerHTML = `
          <div class="error">
            <h2>Error</h2>
            <p>No se pudo cargar la información del cliente.</p>
            <button class="toolbar-btn" onclick="window.location.href='index.html#leads'" style="margin-top: 20px;">
              Volver a Leads
            </button>
          </div>
        `;
      }
    }
    
    // Helpers
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    function calculateDaysInStatus(createdAt) {
      const created = new Date(createdAt);
      const now = new Date();
      const diffTime = Math.abs(now - created);
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      return diffDays;
    }
    
    const STATE_NAMES = {
      'AL': 'Alabama', 'AK': 'Alaska', 'AZ': 'Arizona', 'AR': 'Arkansas', 
      'CA': 'California', 'CO': 'Colorado', 'CT': 'Connecticut', 'DE': 'Delaware',
      'FL': 'Florida', 'GA': 'Georgia', 'HI': 'Hawaii', 'ID': 'Idaho',
      'IL': 'Illinois', 'IN': 'Indiana', 'IA': 'Iowa', 'KS': 'Kansas',
      'KY': 'Kentucky', 'LA': 'Louisiana', 'ME': 'Maine', 'MD': 'Maryland',
      'MA': 'Massachusetts', 'MI': 'Michigan', 'MN': 'Minnesota', 'MS': 'Mississippi',
      'MO': 'Missouri', 'MT': 'Montana', 'NE': 'Nebraska', 'NV': 'Nevada',
      'NH': 'New Hampshire', 'NJ': 'New Jersey', 'NM': 'New Mexico', 'NY': 'New York',
      'NC': 'North Carolina', 'ND': 'North Dakota', 'OH': 'Ohio', 'OK': 'Oklahoma',
      'OR': 'Oregon', 'PA': 'Pennsylvania', 'RI': 'Rhode Island', 'SC': 'South Carolina',
      'SD': 'South Dakota', 'TN': 'Tennessee', 'TX': 'Texas', 'UT': 'Utah',
      'VT': 'Vermont', 'VA': 'Virginia', 'WA': 'Washington', 'WV': 'West Virginia',
      'WI': 'Wisconsin', 'WY': 'Wyoming'
    };
    
    function getStateName(code) {
      return STATE_NAMES[code?.toUpperCase()] || code;
    }
    
    function getStatusBadge(status) {
      const classes = {
        'New Lead': 'status-badge new',
        'Submitted to UW': 'status-badge submitted',
        'Docs Back': 'status-badge docs',
        'Sent to Debt Manager': 'status-badge manager',
        'Callback Requested': 'status-badge callback',
        'Test': 'status-badge test'
      };
      const className = classes[status] || 'status-badge new';
      return `<span class="${className}">${escapeHtml(status)}</span>`;
    }
    
    // Cargar datos
    loadLead();
  </script>
</body>
</html>
